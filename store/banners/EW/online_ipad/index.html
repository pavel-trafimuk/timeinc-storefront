<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>banner</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  
  <script type="text/javascript" src="../../lib/jquery.js"></script>

  <script type="text/javascript" src="../../lib/AdobeLibraryAPI.js"></script>
  <!-- script type="text/javascript" src="../../lib/MockAPI.js"></script -->

  <script type="text/javascript" src="../../settings/{{MAG_CODE}}.js"></script> 
  <script type="text/javascript" src="../../settings/settings_loader.js"></script> 

  <script type="text/javascript" src="../../lib/lucie_entitlements.js"></script> 

  <script type="text/javascript">
    (function() {
      var api = (typeof adobeDPS == "undefined") ? MockAPI : adobeDPS,
          now = +(new Date),
          subs_banner = "subs/index.html?t=" + now,
          nonsubs_banner = "nonsubs/index.html?t=" + now;

      // temporary
      location.href=subs_banner;
      return;

      api.initializationComplete.addOnce(function() {
        // APPLE SUBSCRIBERS
        var is_sub = false;
        $.each(api.receiptService.availableSubscriptions, function(i, receipt) {
          if (receipt.isActive()) {
            is_sub = true;
            location.href = subs_banner;
          }
        });
        if (is_sub) return;

        // LUCIE SUBSCRIBERS
        if (api.authenticationService.isUserAuthenticated) {
          lucieApi._default_api_args.authToken = api.authenticationService.token;
          lucieApi.entitlements(function(data) {
            if ($("subscriberIsActive", data).text() == "Y") {
              location.href = subs_banner;
            }
            else {
              location.href = nonsubs_banner;
            }
          });
        }
        else {
          location.href = nonsubs_banner;
        }
      });
    })();
  </script>

</head>
<body><div></div></body></html>

