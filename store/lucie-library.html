<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title></title>
  
  <meta name="ROBOTS" content="NOINDEX,NOFOLLOW,NOARCHIVE" />
  <link rel="stylesheet" href="css/lucie-library.css" />
    <script type="text/javascript">
      if (!/dev\=true/.test(location.search)) {
        document.write("<scr"+"ipt src='lib/AdobeLibraryAPI.js' type='text/javascript'></scr"+"ipt>");
      }
    </script>
    <script src="lib/jquery.js" type="text/javascript"></script> 
    <script src="settings/{{MAG_CODE}}.js?v={{BUILD_TIME}}" type="text/javascript"></script>
    <script src="settings/settings_loader.js?v={{BUILD_TIME}}" type="text/javascript"></script>
    <script type="text/javascript" src="lib/md5.js" type="text/javascript"></script>
</head>

<body>
  <div id="mask"></div>
  <div id="container">
    <div class="x-toolbar x-toolbar-dark main-popup-toolbar">
      <div class="brand-logo" style="height: 40px;"></div>
    </div>
    
    <!--<div id="txt1" style="background: #FFF; height: auto;"></div>-->
    
    <div class="lucie-complete-inner">
      <div class="lucie-complete-header">
      	<script type="text/javascript">
      	 if ("{{MAG_CODE}}" == "PP") { document.write("Gracias") } else { document.write("Thank You")}
      	</script>
  	  </div>
      <div class="lucie-complete-body">
      	<script type="text/javascript">
         if ("{{MAG_CODE}}" == "PP") { document.write("Procesando la solicitud...") } else { document.write("Processing your request...")}
        </script>
      </div>
   </div>
 </div>
     
     <!-- SiteCatalyst -->
  <div style="display:none;">
  <script type="text/javascript" src="//subscription-assets.timeinc.com/prod/assets/appstorefronts-jq/omniture/{{MAG_CODE}}/s_code.js"></script>
    <script type="text/javascript" >
      function dateFormat(d) {
        var curr_date = d.getDate(),
          curr_month = d.getMonth() + 1,
          curr_year = d.getFullYear(),
          curr_hour = d.getHours(),
          meridiem,
          halfHour,
          retDate;
          
          
          curr_month = (curr_month < 10) ? "0" + curr_month : curr_month;
          curr_date = (curr_date < 10) ? "0" + curr_date : curr_date;
          meridiem = (curr_hour > 12) ? "PM" : "AM"; // Must determine meridiem before modifying curr_hour
          curr_hour = (curr_hour < 10) ? "0" + curr_hour : curr_hour;
          curr_hour = (curr_hour > 12) ? curr_hour - 12 : curr_hour;
          halfHour = (d.getMinutes() >= 30) ? "30" : "00";
          
          
          retDate = curr_month + "/" + curr_date + "/" + curr_year + "-" + curr_hour + ":" + halfHour + meridiem;
    
        return retDate;
      }

      function onOmniture(cfg) {
        try {
          console.log('onOmniture', cfg);
        
          var today = new Date(),
            orientation = (window.orientation == 0 || window.orientation == 180) ? 'portrait' : 'landscape',
            dayOfWeek = new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday");
              
          s.events = cfg.events;
          s.pageName = cfg.pageName;
          s.prop8 = cfg.prop8;
          s.prop10 = cfg.prop10;
          s.eVar28 = cfg.eVar28;
          s.eVar33 = cfg.eVar33;
              
          s.server = window.location.host;
          s.timestamp = Math.round(today.getTime() / 1000);
          s.visitorID = s.eVar3 = localStorage.visitorId;
          s.prop3 = "D=User Agent";
          
          s.prop16 = s.eVar24 = "store";
          s.prop17 = location.protocol + "//" + location.host + location.pathname;
          s.prop18 = orientation;
          s.prop19 = 'online';
          s.prop26 = 'dsc';
          s.prop29 = '';
          s.prop35 = s.eVar35 = "pageview";
          s.prop36 = s.eVar36 = 'storefront';
          s.eVar30 = dayOfWeek[today.getDay()].toLowerCase();
          s.prop7 = s.eVar31 = dateFormat(today);
          s.eVar32 = (today.getDay() == 0 || today.getDay() == 6) ? "weekend" : "weekday";
           
          s.pageType = "";
      
          var s_code = s.t();
          if(s_code){document.write(s_code);}
        } catch (e) {
          console.log('ERROR in lucie-reg-js-omniture.js::onOmniture', e);
        }
      }
      
      function onOmnitureTL(cfg) {
        try {
          console.log("omni tl2 ", cfg);
        
          var today = new Date(),
            orientation = (window.orientation == 0 || window.orientation == 180) ? 'portrait' : 'landscape',
            keys = Object.keys(cfg),
            keysLength = keys.length,
            dayOfWeek = new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday");
              
          s.events = cfg.events;
          s.pageName = cfg.pageName;
          s.prop8 = cfg.prop8;
          s.prop10 = cfg.prop10;
          s.eVar28 = cfg.eVar28;
          s.eVar33 = cfg.eVar33;
              
          
          s.linkTrackVars = keys.join(',') + ',prop3,prop7,prop16,prop18,prop19,prop26,prop29,prop35,prop36,eVar3,eVar24,eVar26,eVar29,eVar30,eVar31,eVar32,eVar35,eVar36,eVar44,events';
          s.linkTrackEvents = cfg.events;
          s.server = window.location.host;
          s.timestamp = Math.round(today.getTime() / 1000);
          s.visitorID = s.eVar3 = localStorage.visitorId;
          s.prop3 = "D=User Agent";
            
          s.prop16 = s.eVar24 = "store";
          s.prop17 = location.protocol + "//" + location.host + location.pathname;
          s.prop18 = orientation;
          s.prop19 = 'online';
          s.prop26 = 'dsc';
          s.prop29 = '';
          s.prop35 = s.eVar35 = "pageview";
          s.prop36 = s.eVar36 = 'storefront';
          s.eVar30 = dayOfWeek[today.getDay()].toLowerCase();
          s.prop7 = s.eVar31 = dateFormat(today);
          s.eVar32 = (today.getDay() == 0 || today.getDay() == 6) ? "weekend" : "weekday";
      
          s.pageType = "";
          
          s.tl(this, 'o', (s.events == 'event44') ? 'splash occurences' : 'user action');
        } catch (e) {
          console.log('ERROR in lucie-reg-js-omniture.js::onOmnitureTL', e);
        }
      }
            
      
      // Track page view
      var cfg = {
        events   : "event1,event26",
        pageName : "store|receipt",
        prop8  : "receipt",
        prop10   : "ipad dps",  // "kf" for kindle fire
        eVar28   : "receipt"
        //eVar33   : "receipt"
      };
    
      // This function found in lucie-customer-creation-omniture.js
      var getVisitorID = window.setInterval(function() {
        if (localStorage.visitorId) {
          window.clearInterval(getVisitorID);
          onOmniture(cfg);
        }
      }, 100);
    </script>
   </div>
   <!-- End SiteCatalyst -->
  
  <script type="text/javascript"> 
        var lucieFormUrl = settings.lucieRegistrationURL,
            getProductId,
            subsReceipt = "",
            subsProductId = "";
            
        $(function() {
            adobeDPS.initializationComplete.addOnce(loadPage);

            // if the receipt isn't found within 30 seconds, give up
            setTimeout(function() {
                adobeDPS.dialogService.dismissCustomDialog();
            }, 30000);
        });

        function loadPage() {
            var receipt_found = false;
            localStorage.visitorId = md5(adobeDPS.deviceService.deviceId);

            $.each(adobeDPS.receiptService.availableSubscriptions, function(productId, sub) {
                if (sub.isActive()) {
                    var join_char = /\?/.test(lucieFormUrl) ? "&" : "?",
                        url = lucieFormUrl + join_char + "sender=lucielibrary&t="+(new Date().getTime());

                    // Looks like: ewoJInNpZ25hdHVyZSIgPSAiQWh5Y05VcEUxNEJPanZZks... (~3000 more chars)
                    url += '&receipt=' + sub.receipt.token;

                    // Looks like: com.timeinc.realsimple.ipad.subs.3
                    url += '&productId=' + sub.productId;

                    // (retrieved above) looks like: CECC9FEA54664B02B7D7F6140A4FCE14
                    url += '&visitorId=' + localStorage.visitorId;

                    setTimeout(function() {
                        window.location.href = url;
                    }, 250);
                    receipt_found = true;

                    // break out of loop
                    return false;
                }                
            });
            if (!receipt_found) setTimeout(loadPage, 1000);
        }
  </script>
</body>
</html>

